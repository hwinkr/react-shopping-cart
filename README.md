# react-shopping-cart

## STEP 1

### 🔑 키워드

State Management, Recoil, RTL, API

### 📍 학습 목표

✔️ Recoil을 사용하여 클라이언트 상태를 관리할 수 있다.

✔️ 상태 관리 라이브러리가 왜 이렇게 짜졌는지 이해할 수 있다.

✔️ React Testing Library(RTL)를 활용하여 주요 기능에 대한 테스트를 작성할 수 있다.

### 🎯 기능 요구 사항

- [x] `/cart-items` API를 호출하여 장바구니 상품 데이터를 불러온다.

- [x] 불러온 데이터를 기반으로 Recoil을 사용하여 클라이언트 상태를 관리한다.

- [x] 개별 상품의 선택 여부, 결제 금액, 배송비 등의 상태를 Recoil로 관리한다.

- [x] 상품 선택에 따른 결제 금액, 배송비 등의 동적인 변경 사항을 처리한다.

- [x] 상품 선택/해제 시 결제 금액을 동적으로 변경한다.

- [x] 결제 금액이 10만원 이상일 경우 배송비는 무료이다.

- [x] 장바구니 상품의 수량 변경을 할 수 있다.

- [x] 장바구니에 담긴 상품을 제거할 수 있다.

- [ ] 새로고침해도 선택한 상품 상태를 유지해서 보여준다.

✅ 프로그래밍 요구사항

이전 미션의 프로그래밍 요구사항은 기본으로 포함한다.

- [x] Recoil을 사용하여 장바구니의 상태를 관리한다.

- [x] 장바구니 상품의 다양한 상태를 Atom으로 관리한다.

- [x] 결제 금액, 배송비 등의 파생 상태를 Selector를 통해 계산한다.

- [x] `/cart-items` API를 호출하여 장바구니 데이터를 불러온다. 자세한 API 스펙은 링크를 참고한다.

- [ ] 장바구니의 상태를 스토리지에 저장하여 새로고침 시에도 유지되도록 한다.

### TEST

e.g.

- [x] 장바구니 데이터 로딩: /cart-items API 호출을 통해 초기 장바구니 데이터를 정상적으로 불러오는지 테스트한다.

- [x] 상품 선택 기능: 개별 상품의 선택/해제 시 선택 여부가 정상적으로 변경되는지 테스트한다.

- [x] 결제 금액 계산: 선택된 상품들의 가격 합계가 결제 금액으로 정상 반영되는지 테스트한다.

- [x] 배송비 계산: 결제 금액에 따라 배송비가 정상적으로 계산되는지 (10만원 이상 무료) 테스트한다.

- [x] 수량 변경 기능: 상품의 수량을 변경할 때 올바르게 반영되는지 테스트한다.

- [x] 상품 제거 기능: 장바구니에서 상품을 제거할 때 정상적으로 동작하는지 테스트한다.

## STEP 2

### 🔑 키워드

Derived State, RTL advance

### 📍 학습 목표

✔️ 복잡한 '파생' 상태 관리
✔️ RTL 테스트 고도화

### 🎯 기능 요구 사항

1.복잡한 파생 상태를 고려한다.

🎟️ 쿠폰 목록

다음과 같은 4가지 유형의 쿠폰을 사용할 수 있어야 한다.

각 쿠폰의 특성을 잘 이해하고, 해당 쿠폰을 적용했을 때의 할인 효과를 정확히 계산할 수 있도록 구현한다.

금액을 계산할 때는 주문 금액(쿠폰 적용 전)과 최종 결제 금액(쿠폰 적용 후)으로 나누어서 구분한다.

주문 금액이 10만원이어서 무료 배송 혜택을 받은 상황에서 미라클 모닝 쿠폰으로 할인을 받아 7만원이 되어도 무료 배송 혜택이 그대로 적용 가능하다.

- [x] 5,000원 할인 쿠폰

100,000 금액 이상 구매시 적용, 5,000원 할인

**일단, 사용자가 100,000 이상을 구매한다면 배송비는 내지 않아도 된다.**

**🤔 만약 100,000 이상 구매한다면 무료 배송 쿠폰을 사용할 수 없도록 해야 하는가?**

=> 100,000 이상 구매해도 배송비 쿠폰을 사용할 수 있도록 해주는 경우, 쿠폰을 선택하든 안하든 할인 금액이 변동되지 않기 때문에 할인을 경험시켜 줄 수 없을 것 같다. 따라서, 100,000 이상 구매해서 무료 배송비임을 확정 받았을 경우 배송비 쿠폰은 비활성화 한다.

**🤔 100,000 이상 구매하는 사용자가 제주도민이라면? → 배송비가 3,000 추가 → 무료 배송 쿠폰 적용 → 배송비 무료**

- [x] 2개 구매 시 1개 무료 쿠폰

동일한 제품 3개 이상 구매할 경우 적용.

2종류 이상의 상품을 3개 이강 구매할 경우, 가장 비싼 하나의 상품에 적용

- [x] 5만원 이상 구매 시 무료 배송 쿠폰

50,000 이상 구매시 적용, 배송비 무료, 제주도 및 도서 산간 지역 거주 사용자 모두 무료

- [x] 미라클모닝 30% 할인 쿠폰

오전 4시부터 7시까지 적용, 할인률 30%

### ✅ 프로그래밍 요구사항

이전 미션의 프로그래밍 요구사항을 포함하여 아래 사항들이 추가된다.

- [x] Modal

쿠폰 코드를 입력하기 위한 모달창은 이전 미션에서 만든 모달 컴포넌트 라이브러리를 직접 사용한다.

필요한 기능이 있다면 추가하여 버전을 업데이트한다.

- [x] Test

쿠폰 적용에 따른 다양한 시나리오 및 파생 상태에 대한 테스트 케이스를 작성한다.

**1) cartItemState**

> 클라이언트에서 상품 데이터 관리를 위해서 사용하는 상태

- 장바구니 상품 초기 데이터는 서버 데이터(테스트 시에는 모킹 데이터 사용)와 일치하는지
- 상품 수량 업데이트가 잘 업데이트 되는지
- 상품 수량 업데이트에 따라서, 총 주문 금액이 잘 업데이트 되는지
- 100,000원 이상, 이하인 경우에 따라서 배송비가 업데이트 되는지
- 제주도 및 도서 산간 지역 사용자의 배송비가 업데이트 되는지
- 상품을 제거할 경우, 클라이언트 상태가 삭제를 반영하는지

**2) useCouponAvailability**

> 상품의 사용 가능 여부를 판단하는 책임을 가지는 커스텀 훅

- 존재하는 쿠폰인지 아닌지를 잘 판단하는지
- 존재하는 쿠폰이지만, 유효 기간이 지났는지 아닌지를 잘 판단하는지
- 존재하는 쿠폰, 유효 기간이 지나지 않은 쿠폰이지만 최소 주문 금액 조건을 만족하지 못하는 경우 쿠폰을 사용할 수 없음을 잘 판단하는지
- 존재하는 쿠폰, 유효 기간이 지나지 않은 쿠폰이지만 현재 쿠폰을 사용할 수 없는 시간이라면 사용할 수 없음을 잘 판단하는지
- x개 사면 y개 무료 쿠폰의 사용 가능 여부를 잘 판단하는지
- 배송비 쿠폰의 경우 사용 가능 여부를 잘 판단하는지

**3) useDiscountCalculator**

> (쿠폰을 사용할 수 있는 경우 동작하는 커스텀 훅)
> 쿠폰을 사용했을 때, 쿠폰이 할인해주는 금액을 계산하는 책임을 가지는 커스텀 훅

- 고정 할인 금액을 잘 반환하는지
- percentage 할인을 잘 적용하는지
- x개 사면 y개 무료인 경우, y개 만큼 상품을 무료로 해주는지
- x개 사면 y개 무료인 경우, 가장 비싼 상품을 y개 만큼 무료료 해주는지
- 배송비 쿠폰을 사용할 수 있는 경우, 제주도 및 도서 산간 지역 사용자든 아니든 배송비를 무료료 해주는지

**4) useCartSimulator**

> 쿠폰 사용 모달에서 적용할 수 있는 쿠폰들을 통해 사용자가 얼마나 할인을 받을 수 있는지 계산하는 책임을 가지는 커스텀 훅

- 쿠폰 사용 모달이 처음 렌더링 될 때, 임시 선택 쿠폰 배열이 초기화되어 있는지
- 한 쿠폰을 적용할 경우, 해당 쿠폰이 할인해주는 금액을 잘 계산해서 반환하는지

  - 고정 금액
  - percentage 할인 금액
  - x개 사면 y개 무료
  - 배송비 쿠폰

- 쿠폰을 여러개(2개) 적용하면 모든 할인 금액을 잘 계산해서 반환하는지
- 쿠폰을 3개 이상 적용하려고 하는 경우 예외 피드백(alert)를 전달하고, 임시 선택 쿠폰 배열을 업데이트 하지 않는지

- [ ] Recoil

쿠폰 로직과 관련하여 발생하는 파생 상태를 점진적으로 Recoil을 이용하여 관리해본다.

- [x] API

coupons API를 호출하여 쿠폰 목록을 불러와서 사용한다.
